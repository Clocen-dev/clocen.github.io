<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RIASEC – Digitaler Fragebogen</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --muted:#94a3b8;       /* slate-400 */
      --text:#e5e7eb;        /* gray-200 */
      --brand:#22c55e;       /* green-500 */
      --accent:#38bdf8;      /* sky-400 */
      --danger:#ef4444;      /* red-500 */
      --card:#0b1220;        /* deep */
      --chip:#1f2937;        /* gray-800 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:linear-gradient(120deg,var(--bg),#0b1220 60%,#0a1222);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:40px auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .title{font-size:clamp(22px,3vw,34px);font-weight:800;letter-spacing:.2px}
    .subtitle{color:var(--muted)}

    .card{background:radial-gradient(1200px 300px at 20% -10%,rgba(34,197,94,.15),transparent 60%),
                           radial-gradient(900px 400px at 120% -20%,rgba(56,189,248,.15),transparent 60%),
                           linear-gradient(180deg,var(--panel),#0b1220);
      border:1px solid #1f2937;border-radius:20px; padding:22px; box-shadow:0 10px 30px rgba(0,0,0,.35)}

    .grid{display:grid;gap:14px}
    @media (min-width:820px){.grid{grid-template-columns:1.2fr .8fr}}

    .progress{height:10px;background:#0b1220;border:1px solid #1f2937;border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--accent));transition:width .4s ease}

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:.25rem 0 1rem}
    .chip{padding:.28rem .6rem;border:1px solid #293548;background:var(--chip);border-radius:999px;color:var(--muted);font-size:.85rem}

    .section{margin-top:22px}
    .section h2{margin:0 0 6px;font-size:1.1rem;letter-spacing:.3px}
    .hint{color:var(--muted);font-size:.9rem}

    .item{display:flex;align-items:start;gap:10px;justify-content:space-between;padding:10px 12px;border:1px solid #1f2937;background:#0b1220;border-radius:14px}
    .item p{margin:0;max-width:72ch}
    .item .actions{display:flex;gap:8px;white-space:nowrap}
    button.small{font-size:.85rem;padding:.45rem .65rem;border-radius:10px;border:1px solid #243041;background:#101827;color:#e5e7eb;cursor:pointer}
    button.small[data-choice="1"]{border-color:#1f6b3a}
    button.small[data-choice="0"]{border-color:#6b1f1f}
    button.small.active{background:linear-gradient(180deg,#111826,#0d1424);outline:2px solid var(--accent)}

    .pill{display:inline-grid;grid-auto-flow:column;gap:6px;border:1px solid #1f2937;background:#0b1220;border-radius:12px;padding:3px}
    .pill button{padding:.42rem .7rem;border-radius:10px;border:none;color:#cbd5e1;background:transparent;cursor:pointer}
    .pill button[aria-pressed="true"]{background:#12203a;color:#e2e8f0}

    .footer-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:18px}
    .btn{padding:.75rem 1rem;border-radius:12px;border:1px solid #214;
      background:linear-gradient(180deg,#0c1a2e,#0a1422);color:#fff;font-weight:600;letter-spacing:.2px;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--brand),var(--accent));border:none;color:#05121c}
    .btn.ghost{background:transparent;border:1px solid #1f2937;color:#cbd5e1}

    .result{display:none}
    .bars{display:grid;gap:10px;margin-top:16px}
    .bar{display:grid;grid-template-columns:60px 1fr;place-items:center start;gap:10px}
    .bar .track{height:12px;background:#0b1220;border:1px solid #1f2937;border-radius:999px;overflow:hidden}
    .bar .fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--brand));transition:width .7s ease}

    .codebox{display:flex;gap:10px;margin-top:10px}
    .code{flex:1;text-align:center;padding:10px 12px;border-radius:14px;border:1px dashed #2a3850;background:#0b1220;font-size:1.2rem;font-weight:800}

    details{border:1px solid #213045;background:#0b1220;border-radius:14px;padding:10px 12px}
    summary{cursor:pointer;color:#cbd5e1}
    .muted{color:var(--muted)}

    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:.9rem; background:#0b1220;border:1px solid #1f2937;border-radius:8px;padding:.15rem .35rem}
  </style>
<style>
  /* Nur fürs Drucken */
  @media print {
    @page { size: A4; margin: 18mm; }

    /* Alles ausblenden … */
    body, html { background: #fff !important; }
    .wrap > * { display: none !important; }
    /* … außer der Ergebnis-Karte */
    #result { display: block !important; box-shadow: none !important; border: none !important; }
    #result .footer-actions { display: none !important; } /* Buttons im PDF ausblenden */
    header, .grid, #formCard { display: none !important; }

    /* Druck-Kopfzeile sichtbar machen */
    .print-header { display: block !important; margin: 0 0 12px; }
    .print-header h1 { margin: 0 0 6px; font-size: 18pt; }
    .print-header .meta { color: #333; font-size: 10pt; }

    /* Farben/Flächen im PDF klarer darstellen */
    .bar .track { border: 1px solid #999 !important; background: #f2f2f2 !important; }
    .bar .fill { background: #555 !important; } /* neutrale Füllfarbe fürs PDF */
    .muted { color: #444 !important; }
    .code { border: 1px solid #bbb !important; background: #f7f7f7 !important; color: #000 !important; }
  }

  /* Auf dem Screen bleibt die Kopfzeile unsichtbar */
  .print-header { display: none; }
</style>
</head>
<body>
  <div style="text-align:center; margin:16px 0;">
    <a href="https://www.youtube.com/watch?v=zxZ5qSjOv7E&t=2s" target="_blank" style="color:#38bdf8; font-weight:bold; text-decoration:none;">
      ▶ Zum Video auf YouTube
    </a>
  </div>

  <div class="wrap">
    <header>
      <div>
        <div class="title">RIASEC – Digitaler Online‑Test</div>
        <div class="subtitle">Basierend auf dem analogen Fragebogen (Tätigkeiten · Fähigkeiten · Berufe · Selbsteinschätzung). Wähle pro Zeile genau eine Option.</div>
      </div>
      <div style="min-width:220px">
        <div class="chips" id="legend"></div>
        <div class="progress" aria-label="Fortschritt"><span id="progress"></span></div>
      </div>
    </header>

    <div class="grid">
      <section class="card" id="formCard" aria-live="polite">
        <div class="section">
          <h2 id="sectionTitle">Lade Fragen…</h2>
          <div class="hint" id="sectionHint"> </div>
        </div>
        <div id="items" class="grid" style="grid-template-columns:1fr"></div>
        <div class="footer-actions">
          <button class="btn ghost" id="prevBtn" disabled>&larr; Zurück</button>
          <button class="btn primary" id="nextBtn">Weiter</button>
        </div>
      </section>

      <aside class="card">
        <h3 style="margin-top:0">So funktioniert’s</h3>
        <ol class="hint" style="margin-top:.2rem">
          <li>Es gibt 4 Blöcke: <strong>Tätigkeiten</strong>, <strong>Fähigkeiten</strong>, <strong>Berufe</strong> und <strong>Selbsteinschätzung</strong>.</li>
          <li>Jeder Block hat 6 Kategorien (R, I, A, S, E, C). R steht für <em>Realistic</em>, I für <em>Investigative</em>, A für <em>Artistic</em>, S für <em>Social</em>, E für <em>Enterprising</em>, C für <em>Conventional</em>.</li>
          <li>Wähle zu jeder Aussage eine Option (gern/ungern oder ja/nein). Punkte zählen nur bei <em>gern</em>/<em>ja</em>.</li>
          <li>Am Schluss erhältst du dein <strong>RIASEC‑Profil</strong> inkl. Drei‑Buchstaben‑Code.</li>
        </ol>
        <details style="margin-top:10px">
          <summary>Keyboard‑Tipps</summary>
          <p class="muted">Mit <span class="kbd">Tab</span> zwischen Aussagen springen, dann <span class="kbd">G</span> für „gern/ja“ und <span class="kbd">U</span> für „ungern/nein“ drücken.</p>
        </details>
      </aside>
    </div>

    <section id="result" class="card result" aria-live="polite">
      <h2 style="margin-top:0">Auswertung</h2>
<div class="print-header" aria-hidden="true">
  <h1>RIASEC – Auswertung</h1>
  <div class="meta" id="printMeta"></div>
</div>

      <p class="hint">Summen über alle 4 Blöcke hinweg. Punkte = Anzahl „gern/ja“.</p>
      <div class="bars" id="bars"></div>
      <div class="codebox">
        <div class="code" id="code1" aria-label="Höchster Code">–</div>
        <div class="code" id="code2" aria-label="Zweithöchster Code">–</div>
        <div class="code" id="code3" aria-label="Dritthöchster Code">–</div>
      </div>
      <p class="hint" id="explain"></p>
      <details>
        <summary>Detailtabelle einblenden</summary>
        <div id="detailTable" class="muted" style="overflow:auto;margin-top:8px"></div>
      </details>
      <div class="footer-actions">
        <button class="btn ghost" id="restart">Neu starten</button>
        <button class="btn" id="printBtn">Drucken / PDF</button>
      </div>
    </section>

  </div>

<script>
/********************************************
 * RIASEC Online – Daten & Engine
 ********************************************/
// Kurztexte für Legende
const LEGEND = {
  R: 'Realistic – praktisch, handwerklich',
  I: 'Investigative – forschend, analytisch',
  A: 'Artistic – kreativ, gestaltend',
  S: 'Social – sozial, helfend',
  E: 'Enterprising – führend, verkaufend',
  C: 'Conventional – ordnend, verwaltend'
};

// Hilfsfunktion: Abschnitt erzeugen
function block(title, hint, mode, data){
  return {title, hint, mode, data};
}
// mode: "bi" = gern/ungern (1/0), label an Buttons

// --- FRAGEN (aus dem abfotografierten Heft, leicht gekürzt & modernisiert) ---
// Hinweis: Die Inhalte können bei Bedarf im Array erweitert/umformuliert werden.
const DATA = [
  block('TÄTIGKEITEN', 'Kreuzen Sie an, was Sie gern bzw. ungern tun würden.', 'bi', {
    R: [
      'elektrische Geräte installieren (anschließen, einbauen)',
      'mit Mechaniker:innen oder Techniker:innen zusammenarbeiten',
      'aus Holz ein Regal/Bücherbrett bauen',
      'bei einer Wohnungsrenovierung mitarbeiten',
      'einen Kurs für Automechanik besuchen',
      'ein Fahrrad reparieren',
      'Verstärkeranlage für ein Konzert einrichten',
      'Maschinen/Werkzeuge mit Motor bedienen',
      'im Garten oder in der Landwirtschaft arbeiten',
      'Metall bearbeiten oder Gegenstände aus Metall herstellen'
    ],
    I: [
      'wissenschaftliche Bücher/Zeitschriften lesen',
      'in einem Forschungslabor oder Labor arbeiten',
      'einen Biologie‑ oder Physikkurs besuchen',
      'ein Experiment mit Chemikalien durchführen',
      'eine mathematische Funktion grafisch darstellen',
      'eine neue Programmiersprache erlernen',
      'Quellen/Dokumente über eine historische Epoche analysieren',
      'an einem naturwissenschaftlichen Projekt arbeiten',
      'geologische Formationen untersuchen',
      'über längere Zeit an der Lösung eines Problems arbeiten'
    ],
    A: [
      'zeichnen, skizzieren oder malen',
      'Möbel, Kleider oder Plakate entwerfen',
      'ein Musikinstrument spielen',
      'Porträts oder andere Fotografien aufnehmen',
      'eine Kurzgeschichte/Ein Roman/Theaterstück schreiben',
      'Musik arrangieren oder komponieren',
      'mit begabten Künstler:innen zusammenarbeiten',
      'auf einer Bühne auftreten',
      'einen Prospekt grafisch gestalten',
      'alte Kunstwerke oder Möbel restaurieren'
    ],
    S: [
      'mit anderen freundlich auskommen',
      'mit Geduld unterrichten oder ausbilden',
      'in der Nachbarschaftshilfe/Spitex mitarbeiten',
      'Menschen zuhören, über Probleme sprechen',
      'mit Kindern umgehen',
      'Menschen in Krisen unterstützen',
      'sich in andere hineinversetzen können',
      'eine warme, vertrauensvolle Atmosphäre schaffen',
      'lieber mit Menschen als mit Dingen arbeiten',
      'Kranke oder ältere Menschen betreuen'
    ],
    E: [
      'Strategien für geschäftlichen Erfolg kennenlernen',
      'Arbeit anderer anleiten/organisieren',
      'an Konferenzen teilnehmen',
      'Kurs über Führungs‑ oder Verwaltungstechniken besuchen',
      'eine Arbeitsgruppe führen',
      'über Wirtschaft/Politik diskutieren',
      'als Organisations‑ oder Unternehmensberater:in arbeiten',
      'Finanzierung einer Veranstaltung planen',
      'Aktien kaufen/verkaufen',
      'in der Werbeabteilung eines Unternehmens arbeiten'
    ],
    C: [
      'Buchhaltung führen (für Kleinbetrieb)',
      'Daten in den Computer eingeben',
      'Kopierer und andere Büromaschinen bedienen',
      'Ordnungssystem für Dokumente/ Bücher entwerfen',
      'Lohnabrechnungen erstellen',
      'Schreibarbeiten/Belege kontrollieren',
      'Verzeichnisse für Anschaffungen/Produkte erstellen',
      'Listen/Dateien führen',
      'Personal­daten verwalten',
      'Formulare ausfüllen (z. B. Steuer)'
    ]
  }),

  block('FÄHIGKEITEN', 'Markieren Sie, was Sie gut und kompetent ausführen können.', 'bi', {
    R: [
      'Stichsäge, Drehbank oder Schleifmaschine bedienen',
      'am Auto Öl oder Reifen wechseln',
      'mit Näh‑ oder Bohrmaschine arbeiten',
      'Möbel nach Skizze zusammenbauen oder reparieren',
      'einfache Elektrik‑Reparaturen ausführen',
      'Fahrradschlauch auswechseln',
      'mit der Axt Holz zerkleinern',
      'verstopftes Abflussrohr reinigen',
      'Gegenstände aus Holz herstellen',
      'Wände einer Wohnung tapezieren'
    ],
    I: [
      'Algebra anwenden, mathematische Probleme lösen',
      'ein Experiment/Projekt durchführen',
      'Halbwertszeit radioaktiver Elemente verstehen',
      'mathematische Funktion grafisch darstellen',
      'chemische Formeln interpretieren',
      'verstehen, warum Satelliten nicht auf die Erde stürzen',
      'wissenschaftlichen Bericht schreiben',
      'Urknall‑Theorie erklären',
      'Rolle der DNS/Genetik erklären',
      'Sachverhalt mit wissenschaftlichen Formeln beschreiben'
    ],
    A: [
      'Musikinstrument spielen',
      'in einem Theaterstück mitspielen',
      'Gedicht spannend vorlesen',
      'ein Bild malen',
      'mit Ton modellieren',
      'im Chor die zweite Stimme singen',
      'Kleider, Plakate oder Möbel entwerfen',
      'gute Geschichten oder Gedichte schreiben',
      'künstlerische Fotos machen',
      'Schaufenster dekorieren'
    ],
    S: [
      'schnell freundliche Beziehungen knüpfen',
      'mit Geduld unterrichten/ausbilden',
      'Nachbarschaftshilfe leisten',
      'guten Rat bei Problemen geben',
      'mit Kindern gut umgehen',
      'traurige/chaotische Leute beruhigen',
      'gutes Verständnis für Beziehungen zeigen',
      'mich in andere einfühlen',
      'vertrauensvolle Atmosphäre schaffen',
      'lieber mit Menschen als Dingen arbeiten'
    ],
    E: [
      'Menschen zu Höchstleistungen motivieren',
      'gut vor Leuten sprechen',
      'Werbekampagne leiten',
      'Arbeit anderer anleiten/organisieren',
      'unternehmerisch denken',
      'überzeugend sein',
      'planen und organisieren',
      'Führungsfähigkeiten zeigen',
      'ein eigenes Geschäft führen',
      'erfolgreich verhandeln'
    ],
    C: [
      'große Dokumentmengen systematisch einordnen',
      'Adressetiketten/Serienbriefe am PC ausdrucken',
      'viel Schreib‑ oder Büroarbeit in kurzer Zeit erledigen',
      'Text‑ und Datenverarbeitungsprogramme anwenden',
      'Einnahmen und Ausgaben richtig verbuchen',
      'in Buchhaltung Soll/Haben berechnen',
      'Briefe korrekt in Amtssprache verfassen',
      'mit großer Ausdauer sorgfältig arbeiten',
      'Bestell‑ oder Steuerformulare ausfüllen',
      'mit verschiedenen Bürogeräten gewandt umgehen'
    ]
  }),

  block('BERUFE', 'Welche Berufe sprechen Sie an? Kreuzen Sie „ja“ oder „nein“.','bi', {
    R: ['Flugzeugmechaniker:in','Automechaniker:in','Zimmermann/Zimmerin','Elektriker:in','Helikopterpilot:in','Schreiner:in/Tischler:in','Metallbauer:in','Förster:in','Gärtner:in','Lastwagenfahrer:in'],
    I: ['Meteorologe/Meteorologin','Biologe/Biologin','Astronom:in','Software‑Entwickler:in','Anthropolog:in','Chemiker:in','Wissenschaftsjournalist:in','Pharmazeut:in','Experimentalpsycholog:in','Medizinisch‑technische:r Laborant:in'],
    A: ['Keramiker:in / Goldschmied:in','Musiker:in','Fotograf:in/Film‑Schaffende:r','Schauspieler:in','Schriftsteller:in','Innenarchitekt:in','Grafiker:in','Modedesigner:in','Karikaturist:in','Sänger:in'],
    S: ['Berufsberater:in','Heilpädagog:in','Kindergärtner:in','Berater:in für Drogenabhängige','Lehrlingsausbilder:in','Psychotherapeut:in','Erzieher:in','Logopäd:in','Pflegefachperson','Sozialarbeiter:in'],
    E: ['Tourismusfachmann/-frau','Betriebswirtschafter:in','Geschäftsführer:in','Unternehmensberater:in','Börsenhändler:in','Verkaufsleiter:in (Marketing)','PR‑Verantwortliche:r','Kundenberater:in','Politiker:in','Manager:in'],
    C: ['Buchhalter:in','Netzwerk‑Administrator:in','Geschäftsprüfer:in/Controller:in','Bankkassierer:in','Immobilien‑Verwalter:in','Versicherungsexpert:in','Archivarin/Bibliothekar:in','Sekretär:in','Sachbearbeiter:in','Gerichtsbeamter:in']
  }),

  block('SELBSTEINSCHÄTZUNG', 'Wie stark sehen Sie sich in den einzelnen Bereichen? (1 = gar nicht, 5 = sehr stark).', 'likert', {
    R: ['praktisch/handwerklich begabt','technisch versiert','körperlich belastbar','gerne „anpacken“','mag Arbeit im Freien'],
    I: ['logisch‑analytisch','neugierig/forschend','mathematisch interessiert','naturwissenschaftlich interessiert','problemlösend'],
    A: ['kreativ/gestaltend','musikalisch','schreibend/sprachlich','ästhetisches Empfinden','originelle Ideen'],
    S: ['empathisch','hilfsbereit','geduldig','kommunikativ','teamorientiert'],
    E: ['durchsetzungsstark','führungsorientiert','unternehmerisch','risikofreudig','verhandlungssicher'],
    C: ['ordnend/strukturierend','sorgfältig/zuverlässig','zahlenaffin','regelkonform','büroorganisatorisch stark']
  })
];

// Zustände
let step = 0; // 0..DATA.length-1
const answers = {}; // {blockIndex: { code: [0/1/2..] }}
const totals = {R:0,I:0,A:0,S:0,E:0,C:0};

// DOM Referenzen
const sectionTitle = document.getElementById('sectionTitle');
const sectionHint  = document.getElementById('sectionHint');
const itemsWrap    = document.getElementById('items');
const progressBar  = document.getElementById('progress');
const nextBtn      = document.getElementById('nextBtn');
const prevBtn      = document.getElementById('prevBtn');
const resultCard   = document.getElementById('result');
const barsWrap     = document.getElementById('bars');

// Legende
(function renderLegend(){
  const legend = document.getElementById('legend');
  Object.entries(LEGEND).forEach(([k,v])=>{
    const el = document.createElement('span'); el.className='chip'; el.textContent=`${k} – ${v.split('–')[0].trim()}`; legend.appendChild(el);
  });
})();

function renderStep(){
  const blk = DATA[step];
  sectionTitle.textContent = `${step+1}/${DATA.length} · ${blk.title}`;
  sectionHint.textContent = blk.hint;
  itemsWrap.innerHTML = '';

  // Erzeuge Items pro Kategorie (Reihenfolge R I A S E C)
  const order = ['R','I','A','S','E','C'];
  const sectionAnswers = answers[step] || (answers[step] = {R:[],I:[],A:[],S:[],E:[],C:[]});

  order.forEach(code=>{
    const list = blk.data[code];
    const group = document.createElement('div');
    group.className='section';
    group.innerHTML = `<h2>${code} · ${LEGEND[code]}</h2>`;

    list.forEach((text, idx)=>{
      const row = document.createElement('div');
      row.className='item';
      row.innerHTML = `
        <p>${text}</p>
        <div class="actions">${blk.mode==='likert' ? likert(code, idx) : biButtons(code, idx)}</div>
      `;
      group.appendChild(row);
    });

    itemsWrap.appendChild(group);
  });

  // Progress
  const totalSteps = DATA.length;
  progressBar.style.width = `${((step)/totalSteps)*100}%`;

  // Buttons
  prevBtn.disabled = step===0;
  nextBtn.textContent = step < DATA.length-1 ? 'Weiter' : 'Auswertung anzeigen';

  // Tastaturkürzel (G/U)
  window.onkeydown = (e)=>{
    if(['g','G'].includes(e.key)) { document.querySelector('[data-hotkey="g"]')?.click(); }
    if(['u','U'].includes(e.key)) { document.querySelector('[data-hotkey="u"]')?.click(); }
  }

  function biButtons(code, idx){
    const state = sectionAnswers[code][idx] ?? null; // null/0/1
    const yesActive = state===1 ? 'active' : '';
    const noActive = state===0 ? 'active' : '';
    return `
      <div class="pill" role="group" aria-label="Antwort wählen">
        <button class="small ${yesActive}" data-choice="1" data-code="${code}" data-idx="${idx}" data-hotkey="g" aria-pressed="${state===1}">gern / ja</button>
        <button class="small ${noActive}" data-choice="0" data-code="${code}" data-idx="${idx}" data-hotkey="u" aria-pressed="${state===0}">ungern / nein</button>
      </div>`;
  }
  function likert(code, idx){
    const val = sectionAnswers[code][idx] ?? 3; // default 3
    return `
      <label class="muted" style="display:inline-flex;align-items:center;gap:8px">
        <span style="min-width:42px;text-align:right">${val}</span>
        <input type="range" min="1" max="5" step="1" value="${val}" data-code="${code}" data-idx="${idx}" class="likert"/>
      </label>`;
  }
}

// Delegation für Buttons/Slider
itemsWrap.addEventListener('click', (e)=>{
  const t = e.target.closest('button.small');
  if(!t) return;
  const code = t.dataset.code, idx = +t.dataset.idx, choice = +t.dataset.choice; 
  const sectionAnswers = answers[step];
  sectionAnswers[code][idx] = choice;
  renderStep();
});
itemsWrap.addEventListener('input', (e)=>{
  const t = e.target; if(!t.classList.contains('likert')) return;
  const code = t.dataset.code, idx = +t.dataset.idx, val = +t.value;
  answers[step][code][idx] = val; // 1..5
  t.previousElementSibling.textContent = val;
});

nextBtn.addEventListener('click', ()=>{
  if(step < DATA.length-1){ step++; renderStep(); }
  else { evaluate(); }
});
prevBtn.addEventListener('click', ()=>{ if(step>0){ step--; renderStep(); }});

function evaluate(){
  // Fortschrittsbalken voll
  progressBar.style.width = '100%';

  // Totale zurücksetzen
  Object.keys(totals).forEach(k=>totals[k]=0);

  // Block 1–3 (bi): Punkte = Anzahl „gern/ja“
  for(let i=0;i<3;i++){
    const blockAns = answers[i];
    Object.keys(blockAns).forEach(code=>{
      const pts = (blockAns[code]||[]).reduce((s,v)=> s + (v===1 ? 1 : 0), 0);
      totals[code]+=pts;
    });
  }
  // Block 4 (likert): 1..5 skalieren (hier: >=4 zählt als 1 Punkt, sonst 0)
  const lik = answers[3];
  Object.keys(lik).forEach(code=>{
    const pts = (lik[code]||[]).reduce((s,v)=> s + (v>=4 ? 1 : 0), 0);
    totals[code]+=pts;
  });

  // Anzeige
  document.getElementById('formCard').style.display='none';
  resultCard.style.display='block';

  // Balken
  barsWrap.innerHTML='';
  const maxPossible = 30 + 5; // grob: 3*10 + ~5 likert (pro Code) – passt zu den Arrays oben
  const entries = Object.entries(totals);

  entries.forEach(([code,val])=>{
    const row = document.createElement('div'); row.className='bar';
    row.innerHTML = `<strong>${code}</strong><div class="track"><div class="fill" style="width:${(val/maxPossible)*100}%"></div></div>`;
    barsWrap.appendChild(row);
  });

  // Code bilden (Top‑3)
  const sorted = entries.sort((a,b)=> b[1]-a[1]);
  const [c1,c2,c3] = sorted.slice(0,3).map(x=>x[0]);
  const [v1,v2,v3] = sorted.slice(0,3).map(x=>x[1]);
  document.getElementById('code1').textContent = c1 || '–';
  document.getElementById('code2').textContent = c2 || '–';
  document.getElementById('code3').textContent = c3 || '–';
  document.getElementById('explain').textContent = `Dein Drei‑Buchstaben‑Code: ${c1}${c2}${c3}. (${LEGEND[c1].split('–')[0]}, ${LEGEND[c2].split('–')[0]}, ${LEGEND[c3].split('–')[0]})`;

  // Details
  const tbl = [`<table style="border-collapse:collapse;min-width:520px">`,
    `<thead><tr>${['Code','Bezeichnung','Punkte'].map(h=>`<th style='text-align:left;padding:6px 10px;border-bottom:1px solid #294'>${h}</th>`).join('')}</tr></thead>`,
    '<tbody>'];
  sorted.forEach(([k,v])=>{
    tbl.push(`<tr><td style='padding:6px 10px'>${k}</td><td style='padding:6px 10px' class='muted'>${LEGEND[k]}</td><td style='padding:6px 10px'><strong>${v}</strong></td></tr>`);
  });
  tbl.push('</tbody></table>');
  document.getElementById('detailTable').innerHTML = tbl.join('');
}

// Restart
 document.getElementById('restart').addEventListener('click', ()=>{ location.reload(); });
 document.getElementById('printBtn').addEventListener('click', ()=>{ window.print(); });

// Initial render
renderStep();
</script>
<script>

  // Druck-Metadaten: Datum + Drei-Buchstaben-Code
  (function() {
    try {
      const now = new Date();
      const datum = now.toLocaleString('de-CH', { dateStyle: 'medium', timeStyle: 'short' });
      // Versuche, bestehende Code-Variablen zu ermitteln
      const codeParts = [];
      if (typeof c1 !== 'undefined') codeParts.push(c1);
      if (typeof c2 !== 'undefined') codeParts.push(c2);
      if (typeof c3 !== 'undefined') codeParts.push(c3);
      // Fallback: Suche Textknoten im Ergebnis
      let fallback = '';
      const codeNode = document.querySelector('#result [data-code], #code, .code');
      if (codeNode) fallback = (codeNode.textContent || '').replace(/\s+/g,'').slice(0,3);
      const druckCode = (codeParts.join('') || fallback || '–––').padEnd(3,'–').slice(0,3);
      const metaEl = document.getElementById('printMeta');
      if (metaEl) metaEl.textContent = `Datum: ${datum} · Code: ${druckCode}`;
    } catch(e) {
      /* no-op */
    }
  })();
</script>
</body>
</html>
